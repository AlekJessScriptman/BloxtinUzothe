
-- à¹€à¸žà¸´à¹ˆà¸¡à¹ƒà¸™ STATES
local keyStates = {
    Z = {toggle = false, hold = false},
    X = {toggle = false, hold = false},
    C = {toggle = false, hold = false},
    V = {toggle = false, hold = false},
    F = {toggle = false, hold = false},
    E = {toggle = false, hold = false}, -- à¹€à¸žà¸´à¹ˆà¸¡ E
    Tap = {toggle = false, hold = false} -- Tap means M1 click
}

-- à¹€à¸žà¸´à¹ˆà¸¡à¸•à¸±à¸§à¹à¸›à¸£à¸ˆà¸±à¸šà¹€à¸§à¸¥à¸²à¹€à¸‰à¸žà¸²à¸° E
local holdStartTimes = {
    X = nil,
    C = nil,
    E = nil -- à¸ªà¸³à¸«à¸£à¸±à¸š E
}

-- à¹€à¸žà¸´à¹ˆà¸¡à¸•à¸±à¸§à¹à¸›à¸£à¹€à¸à¹‡à¸šà¸ªà¸–à¸²à¸™à¸°à¸§à¹ˆà¸²à¸à¸” E à¹„à¸›à¸«à¸£à¸·à¸­à¸¢à¸±à¸‡
local lastEPressTime = 0

-- UI --
createLabel("ðŸ’° Chinatip's Auto Press Script")
for _, key in ipairs({"Z", "X", "C", "V", "F", "E", "Tap"}) do  -- à¹€à¸žà¸´à¹ˆà¸¡ E à¹ƒà¸™à¸™à¸µà¹‰
    createToggleButton("Auto Press " .. key, function(on)
        keyStates[key].toggle = on
    end)
    createToggleButton("Hold Key " .. key, function(on)
        keyStates[key].hold = on
    end)
end

-- MAIN LOOP --
RunService.Heartbeat:Connect(function()
    local currentTime = tick()
    for key, state in pairs(keyStates) do
        if state.toggle then
            if key == "Tap" then
                if state.hold then
                    mousePress()
                else
                    mousePress()
                    task.wait(0.05)
                    mouseRelease()
                end
            else
                local keyCode = Enum.KeyCode[key]
                if key == "E" then
                    -- à¸ªà¸³à¸«à¸£à¸±à¸š E: à¸–à¹‰à¸²à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸à¸”à¹ƒà¸™ 5 à¸§à¸´à¸™à¸²à¸—à¸µ à¸à¸”à¹ƒà¸«à¹‰
                    if not holdStartTimes.E then
                        holdStartTimes.E = currentTime
                        pressKey(keyCode)
                        lastEPressTime = currentTime
                    else
                        if currentTime - lastEPressTime > 5 then
                            pressKey(keyCode)
                            lastEPressTime = currentTime
                        end
                    end
                    -- à¸«à¸²à¸ Hold à¸à¸”à¸„à¹‰à¸²à¸‡ (à¸à¹‡à¸›à¸¥à¹ˆà¸­à¸¢à¸«à¸¥à¸±à¸‡ 5 à¸§à¸´)
                    if state.hold then
                        if currentTime - holdStartTimes.E > MAX_HOLD_TIME then
                            releaseKey(keyCode)
                            state.hold = false
                            state.toggle = false
                            holdStartTimes.E = nil
                        else
                            pressKey(keyCode)
                        end
                    else
                        holdStartTimes.E = nil
                    end
                else
                    if state.hold then
                        if (key == "X" or key == "C") then
                            if not holdStartTimes[key] then
                                holdStartTimes[key] = currentTime
                                pressKey(keyCode)
                            elseif currentTime - holdStartTimes[key] > MAX_HOLD_TIME then
                                releaseKey(keyCode)
                                state.hold = false
                                state.toggle = false
                                holdStartTimes[key] = nil
                            else
                                pressKey(keyCode)
                            end
                        else
                            pressKey(keyCode)
                        end
                    else
                        holdStartTimes[key] = nil
                        pressKey(keyCode)
                        task.wait(0.05)
                        releaseKey(keyCode)
                    end
                end
            end
        else
            if state.hold then
                if key == "Tap" then
                    mouseRelease()
                else
                    releaseKey(Enum.KeyCode[key])
                end
                state.hold = false
                holdStartTimes[key] = nil
            end
        end
    end
end)
